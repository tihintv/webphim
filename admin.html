<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Admin WebPhim</title>
  <style>
    body{font-family:sans-serif;background:#111;color:#fff;display:flex;justify-content:center;padding:20px}
    .box{width:800px;background:#1a1a1a;padding:20px;border-radius:10px}
    input,textarea{width:100%;margin:6px 0;padding:8px;border-radius:6px;border:none;background:#222;color:#fff}
    button{margin-top:10px;padding:8px 12px;background:#3b82f6;border:none;border-radius:6px;color:#fff;cursor:pointer}
    pre{background:#000;padding:10px;border-radius:6px;white-space:pre-wrap;max-height:300px;overflow:auto}
    .movie-list{margin-top:20px}
    .movie-item{background:#222;padding:10px;margin:6px 0;border-radius:6px;display:flex;justify-content:space-between;align-items:center}
    .movie-title{font-weight:bold}
    .delete-btn{background:#e11d48;padding:6px 10px;border:none;border-radius:6px;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div class="box">
    <h2>Thêm phim mới</h2>
    <input id="title" placeholder="Tên phim">
    <input id="year" placeholder="Năm">
    <input id="genres" placeholder="Thể loại (cách nhau dấu phẩy)">
    <input id="poster" placeholder="Poster (ví dụ: posters/abc.jpg)">
    <input id="videoUrl" placeholder="Video chính (YouTube/MP4/Drive)">
    <textarea id="episodes" placeholder="Danh sách tập (mỗi dòng: Tập 1:https://...)"></textarea>
    <textarea id="description" placeholder="Mô tả"></textarea>
    <button onclick="addMovie()">➕ Thêm phim</button>

    <h2>Danh sách phim</h2>
    <div class="movie-list" id="movieList"></div>

    <h3>Dữ liệu JSON (copy vào movies.json)</h3>
    <pre id="output"></pre>
  </div>

  <script>
    let movies = [];

    // Hàm load dữ liệu từ movies.json
    async function loadMovies(){
      try{
        const res = await fetch("movies.json");
        movies = await res.json();
        renderMovies();
        updateOutput();
      }catch(e){
        console.error("Không load được movies.json", e);
      }
    }

    function addMovie(){
      const title=document.getElementById("title").value.trim();
      const year=document.getElementById("year").value.trim();
      const genres=document.getElementById("genres").value.split(",").map(g=>g.trim()).filter(Boolean);
      let poster=document.getElementById("poster").value.trim();
      const videoUrl=document.getElementById("videoUrl").value.trim();
      const description=document.getElementById("description").value.trim();
      const episodes=document.getElementById("episodes").value.split("\n").map(l=>{
        const idx=l.indexOf(":");
        if(idx==-1) return null;
        return {name:l.slice(0,idx).trim(),url:l.slice(idx+1).trim()};
      }).filter(Boolean);

      if(!poster.startsWith("http")){
        poster = poster.replace(/^\.?\//,""); 
      }

      movies.push({id:Date.now(),title,year,genres,poster,videoUrl,episodes,description});
      renderMovies();
      updateOutput();

      // Clear form
      document.querySelectorAll("input,textarea").forEach(el=>el.value="");
    }

    function deleteMovie(id){
      movies = movies.filter(m=>m.id!==id);
      renderMovies();
      updateOutput();
    }

    function renderMovies(){
      const list=document.getElementById("movieList");
      list.innerHTML = movies.map(m=>`
        <div class="movie-item">
          <span class="movie-title">${m.title} (${m.year})</span>
          <button class="delete-btn" onclick="deleteMovie(${m.id})">❌ Xoá</button>
        </div>
      `).join("");
    }

    function updateOutput(){
      document.getElementById("output").textContent = JSON.stringify(movies,null,2);
    }

    loadMovies();
  </script>
</body>
</html>
